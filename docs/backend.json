

{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user profile within the AutoSales AI application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "The user's DUI (Documento Unico de Identidad). Unique identifier for the user profile."
        },
        "name": {
          "type": "string",
          "description": "The user's full name."
        },
        "email": {
          "type": "string",
          "description": "The user's email address.",
          "format": "email"
        },
        "role": {
          "type": "string",
          "description": "The user's role within the system (e.g., Admin, Supervisor, Broker)."
        },
        "authUid": {
          "type": "string",
          "description": "The Firebase Authentication UID for the user."
        }
      },
      "required": [
        "id",
        "name",
        "role",
        "authUid"
      ]
    },
    "Lead": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Lead",
      "type": "object",
      "description": "Represents a sales lead within the AutoSales AI application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the lead."
        },
        "name": {
          "type": "string",
          "description": "The lead's name."
        },
        "phone": {
          "type": "string",
          "description": "The lead's phone number."
        },
        "email": {
          "type": "string",
          "description": "The lead's email address.",
          "format": "email"
        },
        "channel": {
          "type": "string",
          "description": "The channel through which the lead was acquired (e.g., Facebook, WhatsApp)."
        },
        "company": {
          "type": "string",
          "description": "The lead's company name."
        },
        "stage": {
          "type": "string",
          "description": "The current stage of the lead (e.g., active, closed)."
        },
        "createdAt": {
          "type": "string",
          "description": "The date and time the lead was created.",
          "format": "date-time"
        },
        "ownerId": {
          "type": "string",
          "description": "Reference to Staff. The document ID of the user who owns the lead. (Relationship: Staff 1:N Lead)"
        },
        "ownerName": {
          "type": "string",
          "description": "The name of the user who owns the lead."
        },
        "dealershipId": {
          "type": "string",
          "description": "The ID of the dealership this lead belongs to."
        },
        "dealershipName": {
          "type": "string",
          "description": "The denormalized name of the dealership."
        },
        "interestedVehicleId": {
            "type": "string",
            "description": "The ID of the vehicle from the inventory that the lead is interested in."
        },
        "brokerCommission": {
            "type": "number",
            "description": "The commission amount earned by the broker for this specific sale."
        }
      },
      "required": [
        "id",
        "name",
        "phone",
        "channel",
        "stage",
        "createdAt",
        "ownerId",
        "ownerName",
        "dealershipId",
        "dealershipName"
      ]
    },
    "NoteEntry": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "NoteEntry",
      "type": "object",
      "description": "Represents a single entry in a lead's notes history.",
      "properties": {
        "content": {
          "type": "string",
          "description": "The content of the note."
        },
        "author": {
          "type": "string",
          "description": "The name of the user or system that created the note."
        },
        "date": {
          "type": "string",
          "description": "The timestamp of when the note was created.",
          "format": "date-time"
        },
        "type": {
          "type": "string",
          "description": "The type of note entry.",
          "enum": ["Manual", "AI Analysis", "System", "Stage Change", "Owner Change", "Dealership Change", "Vehicle Link"]
        }
      },
      "required": ["content", "author", "date", "type"]
    },
    "KnowledgeBaseArticle": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "KnowledgeBaseArticle",
      "type": "object",
      "description": "Represents an article in the knowledge base.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the knowledge base article."
        },
        "title": {
          "type": "string",
          "description": "The title of the knowledge base article."
        },
        "category": {
          "type": "string",
          "description": "The category of the knowledge base article (e.g., Sales, Product)."
        },
        "content": {
          "type": "string",
          "description": "The content of the knowledge base article."
        }
      },
      "required": [
        "id",
        "title",
        "category",
        "content"
      ]
    },
    "Staff": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Staff",
      "type": "object",
      "description": "Represents a staff member within the AutoSales AI application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "The staff member's unique Firestore document ID."
        },
        "name": {
          "type": "string",
          "description": "The staff member's full name."
        },
        "authUid": {
          "type": "string",
          "description": "The Firebase Authentication UID associated with the staff member."
        },
        "role": {
          "type": "string",
          "description": "The staff member's role within the system (e.g., Admin, Supervisor, Broker)."
        },
        "supervisorId": {
          "type": "string",
          "description": "Reference to Staff. The document ID of the staff member's supervisor. (Relationship: Staff 1:N Staff)"
        },
        "createdAt": {
          "type": "string",
          "description": "The date and time the staff member was created.",
          "format": "date-time"
        },
        "dui": {
          "type": "string",
          "description": "The staff member's DUI (Documento Unico de Identidad)."
        },
        "enrolledCourses": {
          "type": "array",
          "description": "Array of course IDs the user is enrolled in.",
          "items": { "type": "string" }
        },
        "certificates": {
            "type": "array",
            "description": "Array of certificate IDs the user has earned.",
            "items": { "type": "string" }
        },
        "commission": {
          "type": "number",
          "description": "The fixed commission amount per vehicle sold by this staff member."
        }
      },
      "required": [
        "id",
        "name",
        "authUid",
        "role",
        "createdAt"
      ]
    },
     "Notification": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Notification",
      "type": "object",
      "description": "Represents a notification for a user about an event in the system.",
      "properties": {
        "id": { "type": "string", "description": "Unique identifier for the notification." },
        "userId": { "type": "string", "description": "The ID of the staff member this notification is for." },
        "content": { "type": "string", "description": "The notification message." },
        "author": { "type": "string", "description": "The name of the user who sent the notification." },
        "leadId": { "type": "string", "description": "Optional. The ID of the lead related to this notification." },
        "leadName": { "type": "string", "description": "Optional. The name of the lead related to this notification." },
        "createdAt": { "type": "string", "description": "The timestamp of when the notification was created.", "format": "date-time" },
        "read": { "type": "boolean", "description": "Whether the user has read the notification." }
      },
      "required": ["userId", "content", "author", "createdAt", "read"]
    },
    "Todo": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "title": "Todo",
        "type": "object",
        "description": "Represents a single to-do item for a user.",
        "properties": {
            "id": { "type": "string", "description": "Unique identifier for the to-do item." },
            "title": { "type": "string", "description": "The content of the to-do item." },
            "completed": { "type": "boolean", "description": "Whether the to-do item is completed." },
            "createdAt": { "type": "string", "description": "The timestamp of when the to-do was created.", "format": "date-time" },
            "userId": { "type": "string", "description": "The ID of the user who owns this to-do item." },
            "leadId": { "type": "string", "description": "Optional. The ID of the lead related to this to-do." },
            "leadName": { "type": "string", "description": "Optional. The name of the lead related to this to-do." }
        },
        "required": ["id", "title", "completed", "createdAt", "userId"]
    },
    "Appointment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Appointment",
      "type": "object",
      "description": "Represents a scheduled appointment with a lead.",
      "properties": {
        "id": { "type": "string", "description": "Unique identifier for the appointment." },
        "leadId": { "type": "string", "description": "The ID of the lead for this appointment." },
        "leadName": { "type": "string", "description": "The name of the lead." },
        "startTime": { "type": "string", "description": "The start time of the appointment.", "format": "date-time" },
        "endTime": { "type": "string", "description": "The end time of the appointment.", "format": "date-time" },
        "ownerId": { "type": "string", "description": "The ID of the staff member who owns this appointment." },
        "stage": {
            "type": "string",
            "description": "The stage of the lead at the time of booking, synced with the lead's stage.",
            "enum": ["Nuevo", "Calificado", "Citado", "En Seguimiento", "Ganado", "Perdido"]
        }
      },
      "required": ["leadId", "leadName", "startTime", "endTime", "ownerId", "stage"]
    },
    "EmploymentContract": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "EmploymentContract",
      "type": "object",
      "description": "Represents a template for an employment contract.",
      "properties": {
        "id": { "type": "string", "description": "Unique identifier for the contract." },
        "title": { "type": "string", "description": "The title of the contract (e.g., 'Broker Services Agreement')." },
        "version": { "type": "string", "description": "The version of the contract (e.g., '1.0')." },
        "content": { "type": "string", "description": "The full text of the contract, likely in Markdown." },
        "isActive": { "type": "boolean", "description": "Whether this contract is the current active version to be signed." },
        "createdAt": { "type": "string", "description": "The timestamp of when the contract was created.", "format": "date-time" }
      },
      "required": ["id", "title", "version", "content", "isActive", "createdAt"]
    },
    "ContractSignature": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ContractSignature",
      "type": "object",
      "description": "Represents a record of a user signing a specific contract.",
      "properties": {
        "id": { "type": "string", "description": "Unique identifier for the signature record." },
        "userId": { "type": "string", "description": "The ID of the staff member who signed." },
        "userName": { "type": "string", "description": "The name of the staff member who signed." },
        "contractId": { "type": "string", "description": "The ID of the employment contract that was signed." },
        "contractVersion": { "type": "string", "description": "The version of the contract at the time of signing." },
        "signedAt": { "type": "string", "description": "The timestamp of when the signature was recorded.", "format": "date-time" },
        "ipAddress": { "type": "string", "description": "The IP address from which the contract was signed." }
      },
      "required": ["id", "userId", "userName", "contractId", "contractVersion", "signedAt", "ipAddress"]
    },
    "ContractEvent": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ContractEvent",
      "type": "object",
      "description": "Represents an audit log entry for a contract.",
      "properties": {
        "id": { "type": "string", "description": "Unique identifier for the event." },
        "contractId": { "type": "string", "description": "The ID of the contract related to this event." },
        "contractTitle": { "type": "string", "description": "The title of the contract at the time of the event." },
        "contractVersion": { "type": "string", "description": "The version of the contract at the time of the event." },
        "userEmail": { "type": "string", "description": "The email of the user who triggered the event." },
        "userName": { "type": "string", "description": "The name of the user who triggered the event." },
        "eventType": { "type": "string", "description": "The type of event.", "enum": ["Created", "Activated", "Archived"] },
        "timestamp": { "type": "string", "description": "The timestamp of when the event occurred.", "format": "date-time" }
      },
      "required": ["contractId", "contractTitle", "contractVersion", "userEmail", "userName", "eventType", "timestamp"]
    },
    "Application": {
      "title": "Application",
      "type": "object",
      "description": "Represents the data submitted by a candidate through the public application form.",
      "properties": {
        "fullName": { "type": "string" },
        "email": { "type": "string", "format": "email" },
        "whatsappNumber": { "type": "string" },
        "country": { "type": "string" },
        "city": { "type": "string" },
        "paymentModel": { "type": "string" },
        "motivation": { "type": "string" },
        "timeDedication": { "type": "string" },
        "timeManagement": { "type": "string" },
        "salesExperience": { "type": "string" },
        "closingComfort": { "type": "string" },
        "tools": { 
          "type": "object",
          "properties": {
            "smartphone": { "type": "boolean" },
            "internet": { "type": "boolean" },
            "whatsapp": { "type": "boolean" },
            "facebook": { "type": "boolean" }
          }
        },
        "crmExperience": { "type": "string" },
        "incomeModelAgreement": { "type": "string" },
        "fitReason": { "type": "string" },
        "appliedDate": { "type": "string", "format": "date-time" },
        "source": { "type": "string" }
      },
      "required": ["fullName", "email", "whatsappNumber", "country", "city", "paymentModel", "motivation", "timeDedication", "timeManagement", "salesExperience", "closingComfort", "tools", "crmExperience", "incomeModelAgreement", "fitReason", "appliedDate"]
    },
    "Candidate": {
      "title": "Candidate",
      "type": "object",
      "description": "Represents a candidate in the talent acquisition pipeline, including their application data and scoring.",
      "allOf": [{ "$ref": "#/backend/entities/Application" }],
      "properties": {
        "id": { "type": "string" },
        "pipelineStatus": { "type": "string" },
        "lastStatusChangeDate": { "type": "string", "format": "date-time" },
        "score": { "type": "number", "description": "The AI-generated score from 0-100." },
        "aiAnalysis": { "type": "string", "description": "The AI's reasoning for the score." },
        "statusReason": { "type": "string", "description": "The classified status (e.g., Premium, Apto, Descartado)." }
      },
      "required": ["id", "pipelineStatus", "lastStatusChangeDate"]
    },
    "Dealership": {
      "title": "Dealership",
      "type": "object",
      "description": "Represents a car dealership partner.",
      "properties": {
        "id": { "type": "string" },
        "name": { "type": "string" },
        "createdAt": { "type": "string", "format": "date-time" },
        "pocName": { "type": "string", "description": "Point of Contact's name." },
        "pocEmail": { "type": "string", "description": "Point of Contact's email.", "format": "email" },
        "commission": { "type": "number", "description": "The fixed commission amount per vehicle sold." },
        "dealershipCode": { "type": "string", "description": "A unique code to identify the dealership internally." }
      },
      "required": ["id", "name"]
    },
    "Course": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Course",
      "type": "object",
      "description": "Represents a single course in the LMS.",
      "properties": {
        "id": { "type": "string" },
        "title": { "type": "string" },
        "description": { "type": "string" },
        "thumbnailUrl": { "type": "string" },
        "passingScore": { "type": "number" },
        "published": { "type": "boolean" },
        "authorId": { "type": "string" },
        "createdAt": { "type": "string", "format": "date-time" },
        "isDefaultOnboarding": { "type": "boolean", "description": "Whether this is the default course for new user onboarding." }
      },
      "required": ["title", "description", "passingScore", "published", "authorId", "createdAt"]
    },
    "Module": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Module",
      "type": "object",
      "description": "Represents a module within a course.",
      "properties": {
        "id": { "type": "string" },
        "courseId": { "type": "string" },
        "title": { "type": "string" },
        "order": { "type": "number" }
      },
      "required": ["courseId", "title", "order"]
    },
    "Lesson": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Lesson",
      "type": "object",
      "description": "Represents a lesson within a module.",
      "properties": {
        "id": { "type": "string" },
        "courseId": { "type": "string" },
        "moduleId": { "type": "string" },
        "title": { "type": "string" },
        "videoUrl": { "type": "string" },
        "duration": { "type": "number", "description": "Duration in seconds" },
        "order": { "type": "number" }
      },
      "required": ["courseId", "moduleId", "title", "videoUrl", "duration", "order"]
    },
    "Quiz": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Quiz",
      "type": "object",
      "description": "Represents a quiz for a lesson or course.",
      "properties": {
        "id": { "type": "string" },
        "lessonId": { "type": "string" },
        "type": { "type": "string", "enum": ["inVideo", "endLesson", "finalExam"] },
        "passingScore": { "type": "number" },
        "questions": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "question": { "type": "string" },
              "options": { "type": "array", "items": { "type": "string" } },
              "type": { "type": "string", "enum": ["single", "multiple", "open"] },
              "correctIndex": { "type": "number" },
              "correctIndices": { "type": "array", "items": { "type": "number" } },
              "timestamp": { "type": "number", "description": "Timestamp in seconds for in-video quizzes." }
            },
            "required": ["question", "type"]
          }
        }
      },
      "required": ["lessonId", "type", "passingScore", "questions"]
    },
    "UserProgress": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProgress",
      "type": "object",
      "description": "Tracks a user's progress in a course.",
      "properties": {
        "id": { "type": "string" },
        "userId": { "type": "string" },
        "courseId": { "type": "string" },
        "lessonProgress": {
          "type": "object",
          "additionalProperties": {
            "type": "object",
            "properties": {
              "watchedSeconds": { "type": "number" },
              "completed": { "type": "boolean" }
            }
          }
        },
        "quizScores": {
          "type": "object",
          "additionalProperties": { "type": "number" }
        },
        "completed": { "type": "boolean", "default": false }
      },
      "required": ["userId", "courseId"]
    },
    "Certificate": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Certificate",
      "type": "object",
      "description": "Represents a certificate issued to a user.",
      "properties": {
        "id": { "type": "string" },
        "userId": { "type": "string" },
        "courseId": { "type": "string" },
        "issuedAt": { "type": "string", "format": "date-time" },
        "score": { "type": "number" },
        "pdfUrl": { "type": "string" },
        "verificationCode": { "type": "string" }
      },
      "required": ["userId", "courseId", "issuedAt", "score", "pdfUrl", "verificationCode"]
    },
    "Vehicle": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Vehicle",
      "type": "object",
      "description": "Represents a vehicle in the inventory.",
      "properties": {
        "id": { "type": "string" },
        "year": { "type": "number" },
        "make": { "type": "string" },
        "model": { "type": "string" },
        "trim": { "type": "string" },
        "cashPrice": { "type": "number" },
        "downPayment": { "type": "number" },
        "condition": { "type": "string", "enum": ["New", "Used", "Rebuilt"] },
        "mileage": { "type": "number" },
        "transmission": { "type": "string", "enum": ["Automatic", "Manual", "CVT"] },
        "driveTrain": { "type": "string" },
        "exteriorColor": { "type": "string" },
        "interiorColor": { "type": "string" },
        "fuelType": { "type": "string", "enum": ["Gasoline", "Diesel", "Electric", "Hybrid"] },
        "photos": { "type": "array", "items": { "type": "string", "format": "uri" } },
        "status": { "type": "string", "enum": ["Active", "Pending", "Sold"] },
        "vin": { "type": "string" },
        "stockNumber": { "type": "string" },
        "createdAt": { "type": "string", "format": "date-time" },
        "dealershipId": { "type": "string" },
        "dealershipCode": { "type": "string" },
        "commission": { "type": "number" },
        "soldBy": { "type": "string", "description": "The UID of the staff member who sold the vehicle." },
        "soldAt": { "type": "string", "format": "date-time", "description": "The timestamp when the vehicle was marked as sold." }
      },
      "required": ["year", "make", "model", "cashPrice", "condition", "mileage", "status", "createdAt", "dealershipId", "dealershipCode", "commission"]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "dealerships/{dealershipId}",
        "definition": {
          "entityName": "Dealership",
          "schema": {
            "$ref": "#/backend/entities/Dealership"
          },
          "description": "Stores car dealership partners.",
          "params": [
            {
              "name": "dealershipId",
              "description": "The unique dealership ID."
            }
          ]
        }
      },
      {
        "path": "artifacts/{appId}/users/{userId}/profile/data",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profile data. Accessible only by the user (and potentially admins).",
          "params": [
            {
              "name": "appId",
              "description": "The application ID."
            },
            {
              "name": "userId",
              "description": "The unique user ID. Matches the user's document ID."
            }
          ]
        }
      },
      {
        "path": "artifacts/{appId}/public/data/leads/{leadId}",
        "definition": {
          "entityName": "Lead",
          "schema": {
            "$ref": "#/backend/entities/Lead"
          },
          "description": "Stores lead data. Includes denormalized 'ownerId' (document ID) and 'ownerName' for authorization independence.",
          "params": [
            {
              "name": "appId",
              "description": "The application ID."
            },
            {
              "name": "leadId",
              "description": "The unique lead ID."
            }
          ]
        }
      },
      {
        "path": "artifacts/{appId}/public/data/leads/{leadId}/noteHistory/{noteId}",
        "definition": {
          "entityName": "NoteEntry",
          "schema": {
            "$ref": "#/backend/entities/NoteEntry"
          },
          "description": "Stores the history of notes and actions for a single lead.",
           "params": [
            {
              "name": "appId",
              "description": "The application ID."
            },
            {
              "name": "leadId",
              "description": "The unique lead ID."
            },
            {
                "name": "noteId",
                "description": "The unique note ID."
            }
          ]
        }
      },
      {
        "path": "artifacts/{appId}/public/data/knowledge_base/{articleId}",
        "definition": {
          "entityName": "KnowledgeBaseArticle",
          "schema": {
            "$ref": "#/backend/entities/KnowledgeBaseArticle"
          },
          "description": "Stores knowledge base articles.",
          "params": [
            {
              "name": "appId",
              "description": "The application ID."
            },
            {
              "name": "articleId",
              "description": "The unique article ID."
            }
          ]
        }
      },
      {
        "path": "artifacts/{appId}/public/data/staff/{staffId}",
        "definition": {
          "entityName": "Staff",
          "schema": {
            "$ref": "#/backend/entities/Staff"
          },
          "description": "Stores staff member data, where the document ID is auto-generated by Firestore. Accessible by administrators.",
          "params": [
            {
              "name": "appId",
              "description": "The application ID."
            },
            {
              "name": "staffId",
              "description": "The unique staff member ID (auto-generated)."
            }
          ]
        }
      },
      {
        "path": "notifications/{notificationId}",
        "definition": {
            "entityName": "Notification",
            "schema": {
                "$ref": "#/backend/entities/Notification"
            },
            "description": "Stores notifications for users. Each document is a notification for a specific user.",
             "params": [
                {
                    "name": "notificationId",
                    "description": "The unique notification ID."
                }
            ]
        }
      },
       {
        "path": "todos/{todoId}",
        "definition": {
            "entityName": "Todo",
            "schema": {
                "$ref": "#/backend/entities/Todo"
            },
            "description": "Stores to-do items for users. Each document is a task for a specific user.",
             "params": [
                {
                    "name": "todoId",
                    "description": "The unique to-do ID."
                }
            ]
        }
      },
      {
        "path": "appointments/{appointmentId}",
        "definition": {
          "entityName": "Appointment",
          "schema": {
            "$ref": "#/backend/entities/Appointment"
          },
          "description": "Stores appointment data for leads.",
          "params": [
            {
              "name": "appointmentId",
              "description": "The unique appointment ID."
            }
          ]
        }
      },
      {
        "path": "contracts/{contractId}",
        "definition": {
          "entityName": "EmploymentContract",
          "schema": { "$ref": "#/backend/entities/EmploymentContract" },
          "description": "Stores employment contract templates. Managed by Admins.",
          "params": [
            { "name": "contractId", "description": "The unique contract ID." }
          ]
        }
      },
      {
        "path": "signatures/{signatureId}",
        "definition": {
          "entityName": "ContractSignature",
          "schema": { "$ref": "#/backend/entities/ContractSignature" },
          "description": "Stores records of contract signatures by users.",
          "params": [
            { "name": "signatureId", "description": "The unique signature ID." }
          ]
        }
      },
      {
        "path": "contract_events/{eventId}",
        "definition": {
          "entityName": "ContractEvent",
          "schema": { "$ref": "#/backend/entities/ContractEvent" },
          "description": "Stores audit log events related to contract management.",
          "params": [
            { "name": "eventId", "description": "The unique event ID." }
          ]
        }
      },
      {
        "path": "candidates/{candidateId}",
        "definition": {
          "entityName": "Candidate",
          "schema": {
            "$ref": "#/backend/entities/Candidate"
          },
          "description": "Stores information about candidates in the recruiting pipeline.",
          "params": [
            {
              "name": "candidateId",
              "description": "The unique candidate ID."
            }
          ]
        }
      },
      {
        "path": "courses/{courseId}",
        "definition": {
          "entityName": "Course",
          "schema": { "$ref": "#/backend/entities/Course" },
          "description": "Stores LMS course overviews.",
          "params": [{ "name": "courseId", "description": "The unique course ID." }]
        }
      },
      {
        "path": "modules/{moduleId}",
        "definition": {
          "entityName": "Module",
          "schema": { "$ref": "#/backend/entities/Module" },
          "description": "Stores LMS course modules.",
          "params": [{ "name": "moduleId", "description": "The unique module ID." }]
        }
      },
      {
        "path": "lessons/{lessonId}",
        "definition": {
          "entityName": "Lesson",
          "schema": { "$ref": "#/backend/entities/Lesson" },
          "description": "Stores LMS lesson details.",
          "params": [{ "name": "lessonId", "description": "The unique lesson ID." }]
        }
      },
      {
        "path": "quizzes/{quizId}",
        "definition": {
          "entityName": "Quiz",
          "schema": { "$ref": "#/backend/entities/Quiz" },
          "description": "Stores LMS quiz questions and details.",
          "params": [{ "name": "quizId", "description": "The unique quiz ID." }]
        }
      },
      {
        "path": "userProgress/{progressId}",
        "definition": {
          "entityName": "UserProgress",
          "schema": { "$ref": "#/backend/entities/UserProgress" },
          "description": "Tracks individual user progress through courses.",
          "params": [{ "name": "progressId", "description": "The unique progress ID, likely a combination of userId and courseId." }]
        }
      },
      {
        "path": "certificates/{certificateId}",
        "definition": {
          "entityName": "Certificate",
          "schema": { "$ref": "#/backend/entities/Certificate" },
          "description": "Stores issued certificates for users.",
          "params": [{ "name": "certificateId", "description": "The unique certificate ID." }]
        }
      },
      {
        "path": "inventory/{vehicleId}",
        "definition": {
          "entityName": "Vehicle",
          "schema": {
            "$ref": "#/backend/entities/Vehicle"
          },
          "description": "Stores all vehicles available in the inventory.",
          "params": [
            {
              "name": "vehicleId",
              "description": "The unique vehicle ID."
            }
          ]
        }
      }
    ],
    "reasoning": "This Firestore structure is designed to support the AutoSales AI application, prioritizing authorization independence, clarity, and scalability. It leverages structural segregation and denormalization to simplify security rules and ensure efficient data access. The root of the database is segmented by `artifacts/{appId}`, where `appId` allows the application to be instantiated in multiple environments without conflicting documents.\\n\\n**Authorization Independence (CRITICAL):**\\n\\n*   Leads: The `leads` collection, located at `artifacts/{appId}/public/data/leads`, includes the `ownerId` (auto-generated staff document ID) and `ownerName` of the user who owns the lead. This denormalization allows security rules to validate ownership without needing to perform expensive `get()` operations to retrieve user data. This ensures that lead access can be controlled based solely on the data within the lead document itself, combined with the authenticated user's ID.\\n*   Staff: The `staff` collection uses an auto-generated document ID. It includes the `supervisorId` (also an auto-generated ID) for reporting relationships. While the UI only allows Admins to manage staff, we can add roles if needed.\\n\\n**Structural Segregation (Homogeneous Security Posture):**\\n\\n*   User Data: User profiles are stored within the `staff` collection. The mapping between a Firebase Auth UID and the staff document ID happens at login.\\n*   Public Data: The `knowledge_base` and `leads` collections are within the `/public/data/` section of the database. While the security rules may differentiate access within those collections, this design communicates the intent that they are generally readable.\\n\\n**QAPs (Rules are not Filters):**\\n\\n*   List Operations: The segregation of user data and public data allows for secure `list` operations. For example, listing leads requires checking if the user has the correct role (Broker, Supervisor, Admin) and filtering based on `ownerId`.\\n\\n**Global Roles (DBAC):**\\n\\n*   Role-Based Access: User roles are stored in the `staff` document. The system can be expanded to utilize a dedicated `/roles_{role}/{uid}` collection to manage administrative or elevated rights. The UI only uses role to gate access to Staff management features, so this functionality isn't required for compliance."
  }
}

    
